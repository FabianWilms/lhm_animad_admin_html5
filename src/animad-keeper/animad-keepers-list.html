<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/paper-search/paper-search-panel.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/array-selector.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../animad-icons.html">

<!-- GENERATOR pattern: [DOMAINNAME]-[ENTITYNAME]-list -->
<dom-module id="animad-keepers-list">
    <template>
      <style>
      </style>

      <paper-item>
        <paper-item-body>
          <paper-search-panel></paper-search-panel>
        </paper-item-body>
        <paper-button raised on-click="handleNew">New</paper-button>
        <paper-button raised onclick="dialogDeleteSelected.open()">Delete</paper-button>
      </paper-item>

      <paper-dialog id="dialogDeleteSelected">
        <h2>Delete</h2>
        <p>Do you really want delete all selected items?</p>
        <paper-item>
          <paper-button raised dialog-confirm on-click="deleteSelectedRows">Yes</paper-button>
          <paper-button raised dialog-dismiss autofocus>No</paper-button>
        </paper-item>
      </paper-dialog>

      <paper-item>
        <paper-item-body>#</paper-item-body>
        <paper-item-body>First</paper-item-body>
        <paper-item-body>Last</paper-item-body>
        <paper-checkbox on-click="toggleAll" checked="{{_checkedAll}}"></paper-checkbox>
        <paper-icon-button icon="animad-icons:sort"></paper-icon-button>
      </paper-item>

      <!--
      // GENERATOR pattern (camel case): [DOMAINNAME][ENTITYNAME]List - id
      // GENERATOR pattern (camel case): [DOMAINNAME][ENTITYNAME] - items
      -->
      <template is="dom-repeat" id="animadKeepersList" items="{{_keepers}}" >
        <paper-item>
          <paper-item-body>{{index}}</paper-item-body>
          <paper-item-body>{{item.first}}</paper-item-body>
          <paper-item-body>{{item.last}}</paper-item-body>
          <paper-checkbox  on-click="toggleSelection" checked="{{item.checked}}"></paper-checkbox>
          <paper-icon-button icon="animad-icons:delete" on-click="deleteRow"></paper-icon-button>
        </paper-item>
      </template>

      <array-selector id="selector" items="{{_keepers}}" selected="{{selected}}" multi toggle></array-selector>

      <template is="dom-repeat" items="{{selected}}"></template>
<!--// TBD: Dummy, muss wieder raus -->

      <template is="dom-repeat" id="selected" items="{{selected}}" >
        <paper-item>
          <paper-item-body>{{item.first}}</paper-item-body>
          <paper-item-body>{{item.last}}</paper-item-body>
        </paper-item>
      </template>

    </template>

    <script>
      // GENERATOR pattern (camel case): [DOMAINNAME][ENTITYNAME]List
      class AnimadKeepersList extends Polymer.Element {

        static get is() { return 'animad-keepers-list'; }

        static get properties() {
          // TBD: Im Moment ist checked im Array, aber in den Daten aus dem Backend wird das nicht so übertragen
          // Entweder: Array kopieren und im neuen Array das checked - Feld einführen
          // Oder: Beim Löschen über Button die Checkboxen durch-loopen und auf checked = false setzen...
          return {
            _keepers: {
              type: Array,
              value() {
                return [
                  {first: 'Patti', last: 'Smith', checked: false},
                  {first: 'Polly Jean', last: 'Harvey', checked: false},
                  {first: 'Joan', last: 'Jett', checked: false},
                  {first: 'Beth', last: 'Ditto', checked: false},
                  {first: 'Siouxsie', last: 'Sioux', checked: false},
                  {first: 'Lydia', last: 'Lunch', checked: false},
                  {first: 'Debbie', last: 'Harry', checked: false},
                  {first: 'Sadie', last: 'May', checked: false},
                  {first: 'Kim', last: 'Deal', checked: false},
                  {first: 'Kelly', last: 'Deal', checked: false},
                  {first: 'Courtney', last: 'Love', checked: false},
                  {first: 'Kathleen', last: 'Hanna', checked: false},
                  {first: 'Tobi', last: 'Vail', checked: false},
                  {first: 'Kathi', last: 'Wilcox', checked: false},
                  {first: 'Tanya', last: 'Donelly', checked: false},
                  {first: 'Laura Jane', last: 'Grace', checked: false},
                  {first: 'Donita', last: 'Sparks', checked: false},
                  {first: 'Suzi', last: 'Gardner', checked: false},
                  {first: 'Jennifer', last: 'Finch  ', checked: false},
                  {first: 'Demetra', last: 'Plakas', checked: false},
                ];
              }
            },
          _checkedAll: {
               type: Boolean,
               value: false
           }
          }
        }

        toggleSelection(e) {
          console.log("toggleSelection");
          var item = this.$.animadKeepersList.itemForElement(e.target);
          this.$.selector.select(item);
        }

        toggleAll(e) {
          console.log("toggleAll");
          this.$._checkedAll = !this.$._checkedAll;

          this.splice("$.selector.selected", 0, this.$.selector.selected.length);

          var _items = this.$.animadKeepersList.items;
          for (var i in _items) {
            // TBD: Wird nur checked geändert gehen die Werte in den anderen Feldern verloren...
            this.set(['$.animadKeepersList.items', i ], {
                first: this.$.animadKeepersList.items[i].first,
                last: this.$.animadKeepersList.items[i].last,
                checked: this.$._checkedAll
              });

              if (this.$._checkedAll) {
                this.$.selector.select(this.$.animadKeepersList.items[i]);
              }
          }
          this.$.animadKeepersList.render();

        }

        handleNew() {
          console.log("handleNew");
        }

        deleteSelectedRows(e) {
          console.log(this.$.animadKeepersList);
          var _deleteitems = this.$.selector.selected;
          for (var i in _deleteitems) {
            var index = this.$.animadKeepersList.items.indexOf(_deleteitems[i]);
            this.splice("$.animadKeepersList.items", index, 1);
          }

          this.splice("$.selector.selected", 0, this.$.selector.selected.length);
          this.$.animadKeepersList.render();
          // TBD: Daten im Backend löschen
        }

        deleteRow(e) {
          console.log("deleteRow")
          this.$.selector.clearSelection();
          // TBD: selektierte Checkboxen werden nicht aktualisierts
          this.toggleSelection(e);
          dialogDeleteSelected.open();

        }
      }

      customElements.define(AnimadKeepersList.is, AnimadKeepersList);
    </script>

  </dom-module>
